# --- 1. CORE OPTIONS ---
set -g default-terminal "tmux-256color"
set-option -sa terminal-overrides ",xterm-256color:Tc"
set-option -g status-position top
set-option -g default-shell /usr/bin/zsh
set-option -g default-command "/usr/bin/zsh"
set -s set-clipboard on
set -g mouse on

# Windows/Panes base 1
set -g base-index 1
setw -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on 

# Prefix config
unbind C-b
set -g prefix C-space
bind C-space send-prefix

# --- 2. PLUGINS (TPM) ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'catppuccin/tmux#v2.1.2' # Pin version for stability

# --- 3. CATPPUCCIN V2 STYLE (Set variables before TPM runs) ---
set -g @catppuccin_flavor "macchiato"
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_text " #W"
set -g @catppuccin_window_current_text " #W"

# --- 4. INITIALIZE PLUGINS ---
run "$HOME/.config/tmux/plugins/tpm/tpm"

# --- 5. STATUS BAR MODULES (Must be set AFTER TPM/Catppuccin load) ---
set -g status-left-length 100
set -g status-left ""
set -g status-right-length 100
set -g status-right "#{E:@catppuccin_status_application}"
set -agF status-right "#{E:@catppuccin_status_cpu}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -agF status-right "#{E:@catppuccin_status_battery}"

# --- 6. CUSTOM KEY TABLES (MUST BE AT THE VERY BOTTOM) ---
# This ensures they override any plugin defaults for 'w' and 'p'

# Window Table
unbind w
bind-key -T windowtable o new-window -c "#{pane_current_path}"
bind-key -T windowtable c kill-window
bind-key -T windowtable r command-prompt -I "#W" "rename-window '%%'"
bind-key -T windowtable n next-window
bind-key -T windowtable p previous-window
bind-key w switch-client -T windowtable

# Pane Table
unbind p
bind-key -T panetable h split-window -h -c "#{pane_current_path}"
bind-key -T panetable v split-window -v -c "#{pane_current_path}"
bind-key -T panetable c kill-pane
bind-key -T panetable z resize-pane -Z
bind-key -T panetable f resize-pane -Z
bind-key p switch-client -T panetable

# Session Table
unbind s
bind-key -T sessiontable d detach-client                            # [s]ession [d]etach
bind-key -T sessiontable r command-prompt -I "#S" "rename-session '%%'" # [s]ession [r]ename
bind-key -T sessiontable l choose-tree -s                           # [s]ession [l]ist/tree
bind-key -T sessiontable k confirm-before -p "Kill current session #S? (y/n)" kill-session # [s]ession [k]ill

# Trigger the table
bind-key s switch-client -T sessiontable

# Stick terminals for docker 
set-hook -g after-split-window 'if-shell -F "#{==:#{DEV_CONTAINER_ACTIVE},1}" "send-keys \"dev up\" Enter"'
set-hook -g after-new-window 'if-shell -F "#{==:#{DEV_CONTAINER_ACTIVE},1}" "send-keys \"dev up\" Enter"'


run "$HOME/.config/tmux/plugins/tmux-cpu/cpu.tmux"
run "$HOME/.config/tmux/plugins/tmux-battery/battery.tmux"

